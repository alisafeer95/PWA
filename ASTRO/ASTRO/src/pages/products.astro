---
import Layout from "../layouts/Layout.astro";
import ProductCard from "../components/ProductCard.astro";
// Define the API URL
const apiURL = `https://brave-cheese-41d1a63d96.strapiapp.com/api/products?populate=*`;


// Fetch products from the API on the server-side
let products = [];
try {
  const response = await fetch(apiURL);
  const json = await response.json();
  console.log(json)
  products = json.data; // Assumes products are in the `data` field of the response
} catch (error) {
  console.error('Error fetching products:', error);
}


---

<Layout>
<div className="top-bar">
    <button className="cart-button" onClick="window.location.href='/cart'">
       View Cart
    </button>
  </div>
  <div class="product-list">
    {products.length > 0 ? (
      products.map(product => (
        <ProductCard product={product} />
      ))
    ) : (
      <p>No products found.</p>
    )}
  </div>
<script type="module" src="/src/scripts/socket.js"></script>  
</Layout>

<style>
  .product-list {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
</style>
