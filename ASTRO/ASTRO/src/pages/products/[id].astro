---
// File: /src/pages/products/[id].astro
import { updateCart } from '../../helpers/cart'; // Function to update the cart

const { id } = Astro.params;
let product; // Fetch the product by ID
// Define the API URL
const apiURL = `https://brave-cheese-41d1a63d96.strapiapp.com/api/products/${id}`;


try {
  const response = await fetch(apiURL);
  const json = await response.json();
  product = json; // Assumes products are in the `data` field of the response
} catch (error) {
  console.error('Error fetching products:', error);
}


---


{product ? (
  <>
    <h1>{product.data.attributes.Title}</h1>
    <h3>{product.data.attributes.Product_Category}</h3>
    <h4>{product.data.attributes.Price}$</h4>
    
    <astro-greet data-message={id}>
    <button  class="addCart">Add to Cart</button>
    </astro-greet>
  </>
) : (
  <p>Product not found</p>
)}

<style>
  /* Add styles for your product detail page */
  img {
    max-width: 100%;
    height: auto;
  }
</style>

<script >
import { updateCart } from '../../helpers/cart';

  async function addToCart(action, productId) {
    console.log('Adding product to cart:', productId);
    try {
      await updateCart(action, productId);
    } catch (error) {
      console.error('Error adding product to cart:', error);
    }
  }
  
   class AstroGreet extends HTMLElement {
    connectedCallback() {
      // Read the message from the data attribute.
      console.log(this.dataset.message.id)
      const button = this.querySelector('.addCart');
       button.addEventListener("click", async (e) => {
         const productId = this.dataset.message;
         await addToCart("add",productId)
  });
    }
  }

  customElements.define('astro-greet', AstroGreet);
</script>

